<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Mbootu2 by ckhung</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Mbootu2</h1>
      <h2 class="project-tagline">把一顆隨身碟切割、 格式化、 並且用 extlinux 把它變成開機隨身碟。 (重寫版的 mk-boot-usb)</h2>
      <a href="https://github.com/ckhung/mbootu2" class="btn">View on GitHub</a>
      <a href="https://github.com/ckhung/mbootu2/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/ckhung/mbootu2/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="mbootu2" class="anchor" href="#mbootu2" aria-hidden="true"><span class="octicon octicon-link"></span></a>mbootu2</h1>

<h2>一、 簡介</h2>

<p>mbootu2 幫你製作第二代的百毒不侵救命碟。
因為 <strong>它會把你的隨身碟上的所有資料清空</strong>，
所以請特別注意： (1) linux 新手請先把插在電腦上的其他隨身碟通通拔掉，
以免不小心被格式化掉了! (2) 想要製作救命碟的那顆隨身碟，
請先把所有資料先備份到其他地方。

<p>它會把隨身碟切成：
<ol>
<li>第一分割： vfat 主分割區， windows 可以看得見。
<li>第二分割： 延申分割區， 裡面可以有一至數個 linux 邏輯分割。
</ol>
<p>然後它會把 /usr/lib/syslinux 整個目錄拷貝到第一分割的
boot/syslinux 子目錄去， 並且安裝 <a href=
"http://newtoypia.blogspot.tw/2015/02/extlinux.html">
extlinux 開機管理員</a>。 最後它會呼叫 <a href=
"http://newtoypia.blogspot.tw/2015/02/qemu-kvm.html">
qemu 虛擬機管理員</a> 來測試你的隨身碟是否能夠成功開機。

<h2>二、 需求</h2>

<ol>
<li>作業系統必須是 linux
<li>已安裝 perl、 sfdisk、 dosfstools、 extlinux
<li>建議 (但非必須) 備妥 finnix 作業系統資料夾 (光碟或隨身碟皆可)
<li>建議 (但非必須) 安裝 qemu-system-x86 套件以便測試。
</ol>
<p>如果你用 <a href=
"http://newtoypia.blogspot.tw/2014/09/chinese-finnix.html">
阿貴版 finnix</a> 開機， 以上需求都直接滿足。

<h2>三、 安裝</h2>

<ol>
<li>把 mbootu2 拷貝到你的 linux 系統的 /usr/sbin 底下。
<li>在 syslinux/ 子目錄底下有一些圖檔，
還有一個最重要的設定檔 extlinux.conf。
請把這些檔案拷貝到你的 linux 系統的
/usr/lib/syslinux 底下。
</ol>

<h2>四、 一些使用範例</h2>

<p><strong>重要!</strong> 使用 mbootu2 處理 /dev/sdz
之前， 請務必把所有的 /dev/sdz? 都卸載 (umount) 下來。
<ol>
<li>把 /dev/sdz 切成 sdz1 跟 sdz5 兩個分割， 並安裝 extlinux。<br />
<code>mbootu2 -d /dev/sdz</code>
<li>sfdisk 對某些隨身碟過敏， 需要加上
<code>-o force_sfdisk</code> 選項才會成功：<br />
<code>mbootu2 -o force_sfdisk -d /dev/sdz</code>
<li>把 /dev/sdz 切成 sdz1、 sdz5、 sdz6 共三個分割， 並安裝 extlinux。
分配 800MB 給 sdz5、 1200MB 給 sdz6。<br />
<code>mbootu2 -d /dev/sdz -z '800 1200'</code>
<li>/dev/sdz 容量太大 (超過 40000MB， 例如是 64G 的隨身碟)
以至於 mbootu2 不敢動它。 把容量上限調高到 80000MB：
<code>mbootu2 -d /dev/sdz -m 80000</code>
<li>分配大約 12G 給 sdz5、 大約 12G 給 sdz6、 大約 18G 給 sdz7，
改從 /tmp/syslinux 拷貝 syslinux 子目錄，
並且把 /tmp/finnix-110 子目錄拷貝到第一分割的根目錄下：
<code>mbootu2 -d /dev/sdz -m 80000 -s /tmp/syslinux -f /tmp/finnix-110</code>
<li><strong>危險!</strong> 假設這是一部剛買的新電腦，
2T 的主硬碟裡沒有資料。 你用 finnix-ckhung15c 開機，
想要一口氣分割硬碟並安裝 finnix。
那麼可以用以下指令把整顆內建主硬碟原先的內容<strong>全部燒毀</strong>，
並且分配大約 200G 給 sda5、 大約 200G 給 sda6、
大約 600G 給 sda7， 剩下的都給 sda1：
<code>ln -s /cdrom /tmp/finnix-ckhung15c ;
mbootu2 -d /dev/sdz -f /tmp/finnix-ckhung15c
-m 3000000 -o force_sda,force_sfdisk -z '200000 200000 600000'</code>
</ol>

<p>mbootu2 做好開機隨身碟之後， 會呼叫
qemu-system-x86_64 測試你的隨身碟能否開機。
第一次測試經常會失敗。 先不要急著重做，
手動重下一次 qemu-system-x86_64 指令可能就成功了。

<h2>五、 完整選項列表</h2>

<ol>
<li><code>-d /dev/sdz</code> 以 /dev/sdz 為標的隨身碟。
/dev/sdz 的分割表跟其上的每個分割全部都會被一掃而空!
<li><code>-f /tmp/finnix-ckhung15c</code> 把 (內含 finnix 目錄結構的)
/tmp/finnix-ckhung15c 拷貝到標的隨身碟第一分割的根目錄下，
目錄名稱不變。 如果你的 finnix 放在 /cdrom 子目錄下，
但是希望拷貝過去之後改名為 finnix-ckhung15c ，
那麼可以事先建立連結：
<code>cd /tmp ; ln -s /cdrom finnix-ckhung15c</code>
然後在下 mbootu2 指令時， 用
<code>-f /tmp/finnix-ckhung15c</code> 選項。
預設是不會拷貝 finnix 目錄。
<li><code>-m 80000</code> 把標的碟的容量上限調整為 80000MB，
這樣 mbootu2 才敢寫入 64G 的隨身碟。
預設上限是 40000MB， 也就是只能寫入 32G 或更小的隨身碟。
<li><code>-o force_sda</code> 或 <code>-o force_sfdisk</code>
這個 -o 後面可以加上一到數個特殊選項， 當中用半型逗號分開
(不可有空格)。
<ul>
<li><code>force_sda</code> 通常 mbootu2 拒絕把 /dev/sda 當做標的碟。
加了這個選項之後， mbootu2 才敢把 /dev/sda 當做標的碟。
<li><code>force_sfdisk</code> 某些隨身碟在製作時會失敗，
並且看到當中有類似這樣的錯誤訊息：
sfdisk: I don't like these partitions - nothing changed.
(If you really want this, use the --force option.)
那就需要加上這個選項。
</ul>
<li><code>-s /tmp/syslinux</code> 改從 /tmp/syslinux
子目錄拷貝 syslinux 相關檔案。 <strong>注意!</strong>
標的碟上的 syslinux 的版本必須跟
「安裝 extlinux 的時候 (extlinux -i ...) 這個
extlinux 執行檔的版本」 要一致，
否則會無法載入模組。 所以通常沒事的話，
還是接受預設值 /usr/lib/syslinux 比較簡單。
<li><code>-v 2</code> 把 mbootu2 列印訊息的囉嗦程度設為 2。
<li><code>-z '200 800 600'</code> 把五、六、七分割的大小分別設定成
200MB、 800MB、 600MB。 預設是只有 /dev/sdz5 一個邏輯分割，
大小為 6400MB。
</ol>


      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/ckhung/mbootu2">Mbootu2</a> 由 <a href="https://github.com/ckhung">ckhung</a> 維護。</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

